<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>Party U</title>
    <meta chartset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="sortcut icon" href="images/logo.png" type="image/x-icon" />

    <!-- CSS Externos -->
    <link href="stylesheets/validacao.css" rel="stylesheet" />
    <link href="stylesheets/bootstrap.css" rel="stylesheet" />
    <link href="stylesheets/index.css" rel="stylesheet" />
    <!-- Fonte Ballo Da 2 e Poppins -->
    <link
      href="https://fonts.googleapis.com/css?family=Baloo+Da+2|Pangolin|Poppins&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Passion+One&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- Cabeçalho -->
    <header class="align-self-center p-3 bg-white rounded">
      <div id="container" class="container">
        <div class="row">
          <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 text">
            <a href="/"> <p id="titulo_logo">PARTY U</p> </a>
          </div>
        </div>
      </div>
    </header>
    <!-- Main -->
    <main>
      <section>
        <div class="container-fluid">
          <div class="row justify-content-center">
            <div class="col-lg-6">
              <h2 class="text-center titulo">Cadastro Participante</h2>
              <!-- Formulário Cadastro Participante -->

              <div class="container">
                <div class="row">
                  <div class="col-md-12">
                    <form
                      action="/cadastroParticipanteForm"
                      class="needs-validation"
                      data-name="Validation Form"
                      id="verification"
                      method="post"
                      name="wf-form-signup-form"
                      novalidate=""
                    >

                      <div class="form-group form-group-name mx-auto">
                        <label class="label-form-control d-block required" for="firstname" >Nome</label >
                        <input
                          class="form-control form-control-firstname w-100 required"
                          data-validate="name"
                          id="nome"
                          name="nome"
                          placeholder=""
                          required="required"
                          spellcheck="false"
                          title="Insira seu nome"
                          type="text"
                        />
                        <div class="feedback"></div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group form-group-cpf mx-auto">
                        <label class="label-form-control d-block required" for="cpf" >CPF</label >
                        <input
                          class="form-control form-control-cpf w-100 masked required"
                          data-validate="cpf"
                          id="cpf"
                          name="cpf"
                          pattern="^[0-9.-]*$"
                          placeholder="XXX.XXX.XXX-XX"
                          required="required"
                          spellcheck="false"
                          title="Insira seu CPF"
                        />
                        <div class="feedback"></div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group form-group-phone mx-auto">
                        <label class="label-form-control d-block required" for="phone" >Telefone</label >
                        <input
                          class="form-control form-control-phone w-100 masked required"
                          data-validate="phone"
                          id="telefone"
                          name="telefone"
                          pattern="^[0-9() *#+-]+$"
                          placeholder="(XX) XXXXX-XXXX"
                          required="required"
                          spellcheck="false"
                          title="Insira seu telefone"
                        />
                        <div class="feedback"></div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group form-group-cep mx-auto">
                        <label class="label-form-control d-block required" for="cep" >CEP</label >
                        <input
                          class="form-control form-control-cep w-100 masked required"
                          data-validate="cep"
                          id="cep"
                          name="cep"
                          pattern="^[0-9.-]*$"
                          placeholder="XXXXX-XXX"
                          required="required"
                          spellcheck="false"
                          title="Insira seu CEP"
                        />
                        <div class="feedback"></div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group mx-auto">
                        <label class="label-form-control d-block required" for="email" >Email</label>
                        <input
                        class="form-control form-control-email w-100 required"
                        data-validate="email"
                        id="email"
                        name="email"
                        placeholder=""
                        required="required"
                        spellcheck="false"
                        title="Insira seu email"
                        type="text"
                        />
                        <div class="feedback"></div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group form-group-password mx-auto">
                        <label class="label-form-control d-block required" for="password" >Senha</label>
                        <input
                          class="form-control form-control-password w-100 required"
                          data-validate="password"
                          id="password"
                          name="password"
                          placeholder="Insira sua senha"
                          required="required"
                          spellcheck="false"
                          title="Insira sua senha"
                          type="password"
                        />
                        <div class="feedback"></div>
                        <div class="invalid-feedback">
                          Por favor, insira uma senha
                        </div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group form-group-confirm_password mx-auto">
                        <label class="label-form-control d-block required" for="confirm_password" >Confirmar Senha</label>
                        <input
                          class="form-control form-control-password w-100 required"
                          data-validate="confirm_password"
                          id="confirm_password"
                          name="confirm_password"
                          placeholder="Confirme sua senha"
                          required="required"
                          spellcheck="false"
                          title="Confirme sua senha"
                          type="password"
                        />
                        <div class="feedback"></div>
                      </div>
                      <!-- end bootstrap form-group -->

                      <div class="form-group row">
                        <div class="col-md-12 text-center">
                            <button type="submit" class="btn w-100 botao"> Cadastrar </button>
                        </div>
                      </div>
                      <!-- end bootstrap form-group -->
                      
                    </form>
                  </div>
                  <!-- end bootstrap col -->
                </div>
                <!-- end bootstrap row -->
              </div>
              <!-- end bootstrap container -->
            </div>
          </div>
        </div>
      </section>
    </main>

    <section>
      <!-- Modal Feedback -->
      <div
        class="modal fade"
        id="modal-feedback"
        tabindex="-1"
        role="dialog"
        aria-labelledby="modal-adicionar-classe-titulo"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modal-adicionar-classe-titulo">
                Aviso
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">
              <div class="row justify-content-center">
                <div class="col-12">
                  <div class="row">
                    <div class="col-12">
                      <input
                        id="feedback"
                        type="hidden"
                        value="<%= mensagemFeedback %>"
                      />
                      <p
                        id="mensagemFeedback"
                        class="body-text-p text-center"
                      ></p>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-success"
                      data-dismiss="modal"
                    >
                      Fechar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script type="text/javascript" src="javascripts/validacao.js"></script>
    <script type="text/javascript" src="javascripts/jquery.js"></script>
    <script type="text/javascript" src="javascripts/bootstrap.js"></script>
    <script type="text/javascript" src="javascripts/feedback.js"></script>
    <script>
      ;(function () {
    // 'use strict';
    var masking = {
      // User defined Values
      //maskedInputs : document.getElementsByClassName('masked'), // add with IE 8's death
      maskedInputs: document.querySelectorAll('.masked'), // kill with IE 8's death
      maskedNumber: 'XdDmMyY9',
      maskedLetter: '_',

      init: function () {
        masking.setUpMasks(masking.maskedInputs)
        masking.maskedInputs = document.querySelectorAll('.masked') // Repopulating. Needed b/c static node list was created above.
        masking.activateMasking(masking.maskedInputs)
      },

      setUpMasks: function (inputs) {
        var i,
          l = inputs.length

        for (i = 0; i < l; i++) {
          masking.createShell(inputs[i])
        }
      },

      // replaces each masked input with a shall containing the input and it's mask.
      createShell: function (input) {
        var text = '',
          placeholder = input.getAttribute('placeholder')

        input.setAttribute('maxlength', placeholder.length)
        input.setAttribute('data-placeholder', placeholder)
        input.removeAttribute('placeholder')

        text =
          '<span class="shell">' +
          '<span aria-hidden="true" id="' +
          input.id +
          'Mask"><i></i>' +
          placeholder +
          '</span>' +
          input.outerHTML +
          '</span>'

        input.outerHTML = text
      },

      setValueOfMask: function (e) {
        var value = e.target.value,
          placeholder = e.target.getAttribute('data-placeholder')

        return '<i>' + value + '</i>' + placeholder.substr(value.length)
      },

      // add event listeners
      activateMasking: function (inputs) {
        var i, l

        for (i = 0, l = inputs.length; i < l; i++) {
          if (masking.maskedInputs[i].addEventListener) {
            // remove "if" after death of IE 8
            masking.maskedInputs[i].addEventListener(
              'keyup',
              function (e) {
                masking.handleValueChange(e)
              },
              false
            )
          } else if (masking.maskedInputs[i].attachEvent) {
            // For IE 8
            masking.maskedInputs[i].attachEvent('onkeyup', function (e) {
              e.target = e.srcElement
              masking.handleValueChange(e)
            })
          }
        }
      },

      handleValueChange: function (e) {
        var id = e.target.getAttribute('id')

        switch (
          e.keyCode // allows navigating thru input
        ) {
          case 20: // caplocks
          case 17: // control
          case 18: // option
          case 16: // shift
          case 37: // arrow keys
          case 38:
          case 39:
          case 40:
          case 9: // tab (let blur handle tab)
            return
        }

        document.getElementById(id).value = masking.handleCurrentValue(e)
        document.getElementById(
          id + 'Mask'
        ).innerHTML = masking.setValueOfMask(e)
      },

      handleCurrentValue: function (e) {
        var isCharsetPresent = e.target.getAttribute('data-charset'),
          placeholder =
            isCharsetPresent || e.target.getAttribute('data-placeholder'),
          value = e.target.value,
          l = placeholder.length,
          newValue = '',
          i,
          j,
          isInt,
          isLetter,
          strippedValue

        // strip special characters
        strippedValue = isCharsetPresent
          ? value.replace(/\W/g, '')
          : value.replace(/\D/g, '')

        for (i = 0, j = 0; i < l; i++) {
          var x = (isInt = !isNaN(parseInt(strippedValue[j])))
          isLetter = strippedValue[j]
            ? strippedValue[j].match(/[A-Z]/i)
            : false
          matchesNumber = masking.maskedNumber.indexOf(placeholder[i]) >= 0
          matchesLetter = masking.maskedLetter.indexOf(placeholder[i]) >= 0

          if (
            (matchesNumber && isInt) ||
            (isCharsetPresent && matchesLetter && isLetter)
          ) {
            newValue += strippedValue[j++]
          } else if (
            (!isCharsetPresent && !isInt && matchesNumber) ||
            (isCharsetPresent &&
              ((matchesLetter && !isLetter) || (matchesNumber && !isInt)))
          ) {
            // masking.errorOnKeyEntry(); // write your own error handling function
            return newValue
          } else {
            newValue += placeholder[i]
          }
          // break if no characters left and the pattern is non-special character
          if (strippedValue[j] == undefined) {
            break
          }
        }
        if (e.target.getAttribute('data-valid-example')) {
          return masking.validateProgress(e, newValue)
        }
        return newValue
      },

      validateProgress: function (e, value) {
        var validExample = e.target.getAttribute('data-valid-example'),
          pattern = new RegExp(e.target.getAttribute('pattern')),
          placeholder = e.target.getAttribute('data-placeholder'),
          l = value.length,
          testValue = ''

        //convert to months
        if (l == 1 && placeholder.toUpperCase().substr(0, 2) == 'MM') {
          if (value > 1 && value < 10) {
            value = '0' + value
          }
          return value
        }
        // test the value, removing the last character, until what you have is a submatch
        for (i = l; i >= 0; i--) {
          testValue = value + validExample.substr(value.length)
          if (pattern.test(testValue)) {
            return value
          } else {
            value = value.substr(0, value.length - 1)
          }
        }

        return value
      },

      errorOnKeyEntry: function () {
        // Write your own error handling
      }
    }

    masking.init()
    window.addEventListener(
      'load',
      function () {
        function invalidFeedback (inputID, message) {
          console.log(inputID)
          console.log(message)
          $('#' + inputID)
            .removeClass('is-valid is-invalid')
            .addClass('is-invalid') // styles for input
            .closest('.form-group')
            .removeClass('valid invalid')
            .addClass('invalid') // styles for feedback
            .find('.feedback')
            .removeClass('valid-feedback invalid-feedback')
            .addClass('invalid-feedback')
            .text(message)
        }

        function validFeedback (inputID, message) {
          console.log(inputID)
          console.log(message)
          $('#' + inputID)
            .removeClass('is-valid is-invalid')
            .addClass('is-valid') // styles for input
            .closest('.form-group')
            .addClass('valid') // styles for feedback
            .find('.feedback')
            .text(message)
        }

        $('body').on('blur', '.form-control', function () {
          var _this = this
          $(this).each(function () {
            var type = $(this).data('validate')

            console.log(type)
            if (type === 'year') {
              var valid = /^(19|20)\d{2}$/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg = 'Enter 4 digit year. e.g. 1972'
              var validMsg = 'Looks good!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            } 
            
            else if (type === 'date') {
              var valid = /(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.](19|20)\d\d/.test(
                this.value
              )
              var inputID = $(this).attr('id')
              var invalidMsg =
                'Enter full date with 2 digit month, 2 digit day and 4 digit year. e.g. 0 1 0 1 2 0 0 1'
              var validMsg = 'Looks good!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            } 
            
            else if (type === 'patid') {
              var valid = /[a-zA-Z0-9]+/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg =
                'Enter alphanumeric characters only for patient id. e.g. MR12345678'
              var validMsg = 'Looks good!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            } 
            
            else if (type === 'ssn4') {
              var valid = /[0-9]{4}+/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg =
                'Enter the last 4 digits of the social security number. e.g. 0000'
              var validMsg = 'Looks good!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            } 
            
            else if (type === 'name') {
              var valid = /([A-Z][a-z]{3,} )([A-Z][a-z]{3,} )?([A-Z][a-z]{3,})/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg =
                'Insira seu nome completo e sem caracteres especiais'
              var validMsg = 'Tudo certo!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'email') {
              var valid = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg = 'Por favor, insira um email válido'
              var validMsg = 'Tudo certo!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'cpf') {
              var valid = /^\d{3}\.\d{3}\.\d{3}\-\d{2}$/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg = 'invalid cpf'
              var validMsg = 'valid cpf'

              // clean(inputId)

              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'phone') {
              var valid = /^\(?\d{2}\)?[\s-]?[\s9]?\d{4}-?\d{4}$/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg =
                'invalid phone'
              var validMsg = 'valid phone'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'password') {
              var valid = /((?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%!&*]).{8,40})/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg =
                'A senha deve conter letras maiúsculas e minúsculas, números, caracteres especiais e ao menos 8 dígitos.'
              var validMsg = 'Tudo certo!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'confirm_password') {
              var valid = (this.value == document.getElementById('password').value) && document.getElementById('password').value !== "" 
              var inputID = $(this).attr('id')
              var invalidMsg =
                'As senhas não correspondem.'
              var validMsg = 'Tudo certo!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'cep') {
              var valid = /[0-9]{5}-[\d]{3}/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg = 'CEP Inválido'
              var validMsg = 'CEP inválido'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'cnpj') {
              var valid = /^\d{2}\.\d{3}\.\d{3}\/\d{4}\-\d{2}$/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg = 'CEP Inválido'
              var validMsg = 'CEP inválido'

              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

            else if (type === 'empresa') {
              var valid = /^[.@&]?[a-zA-Z0-9 ]+[ !.@&()]?[ a-zA-Z0-9!()]+/.test(this.value)
              var inputID = $(this).attr('id')
              var invalidMsg =
                'Por favor, verifique o nome da empresa'
              var validMsg = 'Tudo certo!'
              if (valid === false) {
                invalidFeedback(inputID, invalidMsg)
              } else {
                validFeedback(inputID, validMsg)
              }
            }

          })

        }) // End: Form Control on Blur Event Listener

        function clean(input) {
          if(input !== null) {
            return input.replace(/[^A-Z0-9]/ig, "");            
          }
        }

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.getElementsByClassName('needs-validation')

        // Loop over them and prevent submission
        var validation = Array.prototype.filter.call(forms, function (
          form
        ) {
          form.addEventListener(
            'submit',
            function (event) {

              if (form.checkValidity() === false) {
                event.preventDefault()
                event.stopPropagation()
              } else {
                var cep = document.getElementById('cep');
                var telefone = document.getElementById('telefone');
                
                cep.value = clean(cep.value);
                telefone.value = clean(telefone.value);

                var cpf = document.getElementById('cpf');
                cpf.value = clean(cpf.value);

                // var cnpj = document.getElementById('cnpj');
                // cnpj.value = clean(cnpj.value);
   
                document.getElementById("validation").submit();
              }

              event.preventDefault();
              event.stopPropagation();

              form.classList.add('was-validated')
              
            },
            false
          ) // End Submit Listener
        })
      },
      false
    ) // End Load Listener
  })()
    </script>

  </body>
</html>
